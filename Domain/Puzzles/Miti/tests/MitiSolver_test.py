from unittest import TestCase

from Domain.Board.Grid import Grid
from Domain.Puzzles.Miti.MitiSolver import MitiSolver
from Domain.Puzzles.utils import positions


class MitiSolverTest(TestCase):
    def test_6x6_37401(self):
        """https://gridpuzzle.com/miti/37401"""
        size = 6
        dots_positions = positions([(0.5, 2.5), (1.5, -0.5), (1.5, 5.5), (2.5, 3.5), (3.5, 5.5), (4.5, 3.5)])

        expected_solution_str = (
            ' ┌──────────────┐ \n'
            ' └─────┐  ┌─────┘ \n'
            ' ┌──┐  │  └─────┐ \n'
            ' │  │  └──┐  ┌──┘ \n'
            ' │  └─────┘  └──┐ \n'
            ' └──────────────┘ '
        )

        game_solver = MitiSolver(dots_positions, size)
        solution = game_solver.get_solution()
        self.assertEqual(expected_solution_str, str(solution))
        other_solution = game_solver.get_other_solution()
        self.assertEqual(Grid.empty(), other_solution)

    def test_8x8_31v5k(self):
        """https://gridpuzzle.com/miti/31v5k"""
        size = 8
        dots_positions = positions([(2.5, 7.5), (3.5, 5.5), (4.5, 0.5), (4.5, 3.5), (4.5, 7.5), (5.5, 5.5), (7.5, 5.5)])

        expected_solution_str = (
            ' ┌────────────────────┐ \n'
            ' │  ┌──────────────┐  │ \n'
            ' │  │  ┌────────┐  └──┘ \n'
            ' │  │  └─────┐  └─────┐ \n'
            ' │  └─────┐  └──┐  ┌──┘ \n'
            ' │  ┌─────┘  ┌──┘  └──┐ \n'
            ' │  └────────┘  ┌──┐  │ \n'
            ' └──────────────┘  └──┘ '
        )

        game_solver = MitiSolver(dots_positions, size)
        solution = game_solver.get_solution()
        self.assertEqual(expected_solution_str, str(solution))
        other_solution = game_solver.get_other_solution()
        self.assertEqual(Grid.empty(), other_solution)

    def test_10x10_210qd(self):
        """https://gridpuzzle.com/miti/210qd"""
        size = 10
        dots_positions = positions([
            (0.5, 7.5), (1.5, 3.5), (1.5, 5.5), (1.5, 9.5), (2.5, 7.5), (4.5, 7.5), (4.5, 9.5), (5.5, 7.5), (6.5, 1.5), (6.5, 5.5), (6.5, 9.5), (7.5, 7.5),
            (9.5, 3.5), (9.5, 7.5)
        ])

        expected_solution_str = (
            ' ┌──────────────────────────┐ \n'
            ' │  ┌─────────────────┐  ┌──┘ \n'
            ' │  │  ┌──┐  ┌──┐  ┌──┘  └──┐ \n'
            ' │  │  │  │  │  └──┘  ┌──┐  │ \n'
            ' │  │  │  │  └────────┘  └──┘ \n'
            ' │  │  │  └─────────────────┐ \n'
            ' │  │  └──────────────┐  ┌──┘ \n'
            ' │  │  ┌────────┐  ┌──┘  └──┐ \n'
            ' │  └──┘  ┌──┐  └──┘  ┌──┐  │ \n'
            ' └────────┘  └────────┘  └──┘ '
        )

        game_solver = MitiSolver(dots_positions, size)
        solution = game_solver.get_solution()
        self.assertEqual(expected_solution_str, str(solution))
        other_solution = game_solver.get_other_solution()
        self.assertEqual(Grid.empty(), other_solution)

    def test_12x12_0xvnw(self):
        """https://gridpuzzle.com/miti/0xvnw"""
        size = 12
        dots_positions = positions([
            (-0.5, 2.5), (-0.5, 4.5), (-0.5, 8.5), (1.5, 7.5), (1.5, 8.5), (3.5, 2.5), (3.5, 4.5), (3.5, 7.5), (4.5, -0.5), (4.5, 2.5), (4.5, 5.5), (5.5, 5.5),
            (5.5, 7.5), (6.5, 1.5), (6.5, 2.5), (6.5, 9.5), (6.5, 11.5), (7.5, -0.5), (7.5, 6.5), (8.5, 1.5), (8.5, 4.5), (9.5, -0.5), (9.5, 6.5), (9.5, 8.5),
            (9.5, 10.5), (11.5, 3.5), (11.5, 6.5), (11.5, 9.5)
        ])

        expected_solution_str = (
            ' ┌─────┐  ┌──┐  ┌────────┐  ┌─────┐ \n'
            ' │  ┌──┘  │  │  │  ┌─────┘  └──┐  │ \n'
            ' │  │  ┌──┘  │  │  └──┐  ┌──┐  │  │ \n'
            ' │  └──┘  ┌──┘  └──┐  └──┘  │  │  │ \n'
            ' └─────┐  └─────┐  └──┐  ┌──┘  │  │ \n'
            ' ┌──┐  │  ┌─────┘  ┌──┘  └─────┘  │ \n'
            ' │  └──┘  └─────┐  │  ┌───────────┘ \n'
            ' └──┐  ┌─────┐  │  │  └─────┐  ┌──┐ \n'
            ' ┌──┘  └──┐  │  └──┘  ┌──┐  │  │  │ \n'
            ' └─────┐  │  │  ┌─────┘  │  └──┘  │ \n'
            ' ┌─────┘  │  │  └──┐  ┌──┘  ┌──┐  │ \n'
            ' └────────┘  └─────┘  └─────┘  └──┘ '
        )

        game_solver = MitiSolver(dots_positions, size)
        solution = game_solver.get_solution()
        self.assertEqual(expected_solution_str, str(solution))
        other_solution = game_solver.get_other_solution()
        self.assertEqual(Grid.empty(), other_solution)

    def test_14x14_4n205(self):
        """https://gridpuzzle.com/miti/4n205"""
        size = 14
        dots_positions = positions([
            (-0.5, 4.5), (-0.5, 9.5), (-0.5, 11.5), (1.5, -0.5), (1.5, 3.5), (1.5, 8.5), (1.5, 10.5), (2.5, 2.5), (2.5, 6.5), (2.5, 8.5), (3.5, -0.5),
            (3.5, 11.5), (4.5, 2.5), (4.5, 5.5), (4.5, 7.5), (4.5, 9.5), (4.5, 13.5), (5.5, -0.5), (6.5, 2.5), (6.5, 4.5), (6.5, 10.5), (6.5, 11.5),
            (6.5, 13.5), (7.5, 8.5), (8.5, 3.5), (8.5, 4.5), (8.5, 6.5), (8.5, 10.5), (8.5, 12.5), (9.5, -0.5), (9.5, 1.5), (9.5, 5.5), (9.5, 8.5),
            (10.5, 3.5), (10.5, 8.5), (11.5, 2.5), (11.5, 4.5), (11.5, 6.5), (11.5, 11.5), (11.5, 13.5), (13.5, 2.5), (13.5, 5.5), (13.5, 10.5)
        ])

        expected_solution_str = (
            ' ┌───────────┐  ┌───────────┐  ┌──┐  ┌──┐ \n'
            ' └────────┐  └──┘  ┌─────┐  └──┘  │  │  │ \n'
            ' ┌────────┘  ┌─────┘  ┌──┘  ┌──┐  │  │  │ \n'
            ' └─────┐  ┌──┘  ┌──┐  └──┐  │  │  └──┘  │ \n'
            ' ┌─────┘  │  ┌──┘  └──┐  └──┘  └──┐  ┌──┘ \n'
            ' └─────┐  │  │  ┌─────┘  ┌─────┐  │  └──┐ \n'
            ' ┌─────┘  └──┘  │  ┌─────┘  ┌──┘  └─────┘ \n'
            ' │  ┌────────┐  │  │  ┌─────┘  ┌──┐  ┌──┐ \n'
            ' │  │  ┌─────┘  └──┘  └──┐  ┌──┘  └──┘  │ \n'
            ' └──┘  └──┐  ┌───────────┘  │  ┌─────┐  │ \n'
            ' ┌────────┘  └──┐  ┌─────┐  └──┘  ┌──┘  │ \n'
            ' │  ┌────────┐  └──┘  ┌──┘  ┌─────┘  ┌──┘ \n'
            ' │  └──┐  ┌──┘  ┌──┐  └─────┘  ┌──┐  └──┐ \n'
            ' └─────┘  └─────┘  └───────────┘  └─────┘ '
        )

        game_solver = MitiSolver(dots_positions, size)
        solution = game_solver.get_solution()
        self.assertEqual(expected_solution_str, str(solution))
        other_solution = game_solver.get_other_solution()
        self.assertEqual(Grid.empty(), other_solution)

    def test_16x16_0y95r(self):
        """https://gridpuzzle.com/miti/0y95r"""
        size = 16
        dots_positions = positions([
            (-0.5, 1.5), (-0.5, 3.5), (-0.5, 7.5), (-0.5, 9.5), (-0.5, 13.5), (1.5, 1.5), (1.5, 2.5), (1.5, 3.5), (1.5, 12.5), (2.5, -0.5), (2.5, 9.5),
            (2.5, 12.5), (2.5, 15.5), (3.5, 1.5), (3.5, 2.5), (3.5, 4.5), (3.5, 7.5), (3.5, 12.5), (4.5, -0.5), (5.5, 1.5), (5.5, 2.5), (5.5, 8.5), (5.5, 10.5),
            (5.5, 13.5), (6.5, 4.5), (6.5, 6.5), (6.5, 8.5), (6.5, 15.5), (7.5, 3.5), (7.5, 6.5), (7.5, 8.5), (7.5, 10.5), (8.5, 0.5), (8.5, 12.5), (8.5, 15.5),
            (9.5, 2.5), (9.5, 6.5), (9.5, 8.5), (9.5, 10.5), (10.5, 8.5), (10.5, 15.5), (11.5, -0.5), (11.5, 1.5), (11.5, 3.5), (11.5, 6.5), (11.5, 8.5),
            (11.5, 10.5), (11.5, 13.5), (12.5, 15.5), (13.5, 3.5), (13.5, 5.5), (14.5, 10.5), (15.5, 1.5), (15.5, 4.5), (15.5, 8.5), (15.5, 13.5)
        ])

        expected_solution_str = (
            ' ┌──┐  ┌──┐  ┌────────┐  ┌──┐  ┌────────┐  ┌──┐ \n'
            ' │  └──┘  └──┘  ┌──┐  │  │  │  └─────┐  └──┘  │ \n'
            ' └──┐  ┌──┐  ┌──┘  │  │  │  └────────┘  ┌─────┘ \n'
            ' ┌──┘  │  └──┘  ┌──┘  │  └──┐  ┌─────┐  └─────┐ \n'
            ' └──┐  │  ┌──┐  │  ┌──┘  ┌──┘  │  ┌──┘  ┌──┐  │ \n'
            ' ┌──┘  └──┘  │  │  │  ┌──┘  ┌──┘  │  ┌──┘  │  │ \n'
            ' │  ┌──┐  ┌──┘  └──┘  └──┐  └──┐  │  └──┐  └──┘ \n'
            ' │  │  └──┘  ┌───────────┘  ┌──┘  └──┐  └─────┐ \n'
            ' │  └─────┐  └─────┐  ┌──┐  │  ┌──┐  └────────┘ \n'
            ' │  ┌──┐  └─────┐  └──┘  │  └──┘  └──┐  ┌─────┐ \n'
            ' │  │  │  ┌──┐  └──┐  ┌──┘  ┌────────┘  │  ┌──┘ \n'
            ' └──┘  └──┘  └──┐  │  └──┐  └───────────┘  └──┐ \n'
            ' ┌───────────┐  │  │  ┌──┘  ┌──┐  ┌───────────┘ \n'
            ' │  ┌─────┐  └──┘  │  │  ┌──┘  │  │  ┌────────┐ \n'
            ' │  │  ┌──┘  ┌──┐  └──┘  │  ┌──┘  └──┘  ┌──┐  │ \n'
            ' └──┘  └─────┘  └────────┘  └───────────┘  └──┘ '
        )

        game_solver = MitiSolver(dots_positions, size)
        solution = game_solver.get_solution()
        self.assertEqual(expected_solution_str, str(solution))
        other_solution = game_solver.get_other_solution()
        self.assertEqual(Grid.empty(), other_solution)

    def test_18x18_4wep8(self):
        """https://gridpuzzle.com/miti/4wep8"""
        size = 18
        dots_positions = positions([
            (-0.5, 1.5), (-0.5, 6.5), (-0.5, 8.5), (-0.5, 13.5), (0.5, 4.5), (0.5, 11.5), (1.5, 7.5), (1.5, 9.5), (1.5, 13.5), (2.5, -0.5), (2.5, 3.5),
            (2.5, 7.5), (2.5, 11.5), (3.5, 17.5), (4.5, -0.5), (4.5, 4.5), (4.5, 6.5), (4.5, 11.5), (4.5, 13.5), (4.5, 14.5), (5.5, 2.5), (5.5, 8.5),
            (5.5, 10.5), (6.5, -0.5), (6.5, 17.5), (7.5, 2.5), (7.5, 5.5), (7.5, 7.5), (7.5, 11.5), (7.5, 12.5), (8.5, 7.5), (8.5, 9.5), (9.5, -0.5),
            (9.5, 1.5), (9.5, 2.5), (9.5, 5.5), (9.5, 10.5), (9.5, 12.5), (10.5, 4.5), (10.5, 8.5), (10.5, 14.5), (11.5, -0.5), (12.5, 1.5), (12.5, 4.5),
            (12.5, 9.5), (12.5, 12.5), (12.5, 14.5), (12.5, 17.5), (13.5, -0.5), (13.5, 2.5), (13.5, 6.5), (14.5, 11.5), (14.5, 12.5), (14.5, 14.5),
            (15.5, -0.5), (15.5, 6.5), (17.5, 5.5), (17.5, 10.5), (17.5, 12.5), (17.5, 15.5)
        ])

        expected_solution_str = (
            ' ┌──┐  ┌───────────┐  ┌──┐  ┌───────────┐  ┌────────┐ \n'
            ' │  └──┘  ┌──┐  ┌──┘  │  └──┘  ┌──┐  ┌──┘  │  ┌──┐  │ \n'
            ' └────────┘  │  │  ┌──┘  ┌──┐  │  │  └──┐  │  │  │  │ \n'
            ' ┌────────┐  │  │  └──┐  │  │  │  │  ┌──┘  │  │  └──┘ \n'
            ' └─────┐  │  │  └─────┘  │  │  │  │  └─────┘  └─────┐ \n'
            ' ┌─────┘  └──┘  ┌──┐  ┌──┘  └──┘  │  ┌──┐  ┌─────┐  │ \n'
            ' └──────────────┘  │  │  ┌─────┐  │  │  │  └──┐  └──┘ \n'
            ' ┌─────────────────┘  │  └──┐  │  └──┘  └──┐  └─────┐ \n'
            ' │  ┌──┐  ┌─────┐  ┌──┘  ┌──┘  └──┐  ┌──┐  └─────┐  │ \n'
            ' └──┘  └──┘  ┌──┘  └──┐  └─────┐  └──┘  └─────┐  │  │ \n'
            ' ┌─────┐  ┌──┘  ┌──┐  └────────┘  ┌───────────┘  │  │ \n'
            ' └──┐  │  └──┐  │  └─────┐  ┌─────┘  ┌─────┐  ┌──┘  │ \n'
            ' ┌──┘  └──┐  │  └─────┐  └──┘  ┌─────┘  ┌──┘  └─────┘ \n'
            ' └─────┐  └──┘  ┌──┐  └─────┐  └─────┐  │  ┌────────┐ \n'
            ' ┌─────┘  ┌─────┘  │  ┌──┐  └────────┘  └──┘  ┌──┐  │ \n'
            ' └────────┘  ┌─────┘  │  └────────┐  ┌─────┐  │  │  │ \n'
            ' ┌───────────┘  ┌──┐  └────────┐  │  │  ┌──┘  │  │  │ \n'
            ' └──────────────┘  └───────────┘  └──┘  └─────┘  └──┘ '
        )

        game_solver = MitiSolver(dots_positions, size)
        solution = game_solver.get_solution()
        self.assertEqual(expected_solution_str, str(solution))
        other_solution = game_solver.get_other_solution()
        self.assertEqual(Grid.empty(), other_solution)

    def test_20x20_2007d(self):
        """https://gridpuzzle.com/miti/2007d"""
        size = 20
        dots_positions = positions([
            (-0.5, 2.5), (-0.5, 5.5), (-0.5, 7.5), (-0.5, 15.5), (-0.5, 17.5), (0.5, 13.5), (1.5, 6.5), (1.5, 15.5), (2.5, 0.5), (2.5, 3.5), (2.5, 13.5),
            (3.5, 3.5), (3.5, 5.5), (3.5, 10.5), (3.5, 14.5), (3.5, 16.5), (4.5, -0.5), (4.5, 8.5), (4.5, 19.5), (5.5, 9.5), (5.5, 11.5), (5.5, 14.5),
            (5.5, 17.5), (6.5, -0.5), (6.5, 3.5), (6.5, 5.5), (6.5, 19.5), (7.5, 3.5), (7.5, 7.5), (7.5, 10.5), (7.5, 12.5), (7.5, 14.5), (8.5, 6.5),
            (8.5, 8.5), (8.5, 16.5), (9.5, -0.5), (9.5, 10.5), (9.5, 11.5), (9.5, 19.5), (10.5, 2.5), (10.5, 5.5), (10.5, 8.5), (10.5, 14.5), (10.5, 15.5),
            (10.5, 16.5), (11.5, 5.5), (11.5, 8.5), (11.5, 10.5), (11.5, 13.5), (11.5, 17.5), (11.5, 19.5), (12.5, 6.5), (12.5, 15.5), (13.5, -0.5),
            (13.5, 8.5), (13.5, 10.5), (14.5, 2.5), (14.5, 14.5), (14.5, 18.5), (15.5, -0.5), (15.5, 2.5), (15.5, 6.5), (15.5, 7.5), (15.5, 10.5), (15.5, 12.5),
            (15.5, 14.5), (15.5, 16.5), (16.5, 2.5), (16.5, 4.5), (16.5, 12.5), (16.5, 18.5), (17.5, 7.5), (17.5, 16.5), (18.5, 4.5), (19.5, 1.5), (19.5, 7.5),
            (19.5, 9.5), (19.5, 11.5), (19.5, 16.5)
        ])

        expected_solution_str = (
            ' ┌─────┐  ┌─────┐  ┌──┐  ┌────────────────────┐  ┌──┐  ┌──┐ \n'
            ' │  ┌──┘  │  ┌──┘  │  └──┘  ┌───────────┐  ┌──┘  │  │  │  │ \n'
            ' │  └─────┘  │  ┌──┘  ┌─────┘  ┌────────┘  └──┐  │  │  │  │ \n'
            ' │  ┌─────┐  └──┘  ┌──┘  ┌─────┘  ┌────────┐  └──┘  └──┘  │ \n'
            ' └──┘  ┌──┘  ┌──┐  │  ┌──┘  ┌──┐  │  ┌──┐  │  ┌───────────┘ \n'
            ' ┌─────┘  ┌──┘  │  │  └──┐  │  └──┘  │  │  │  └───────────┐ \n'
            ' └────────┘  ┌──┘  └──┐  │  │  ┌──┐  │  │  │  ┌─────┐  ┌──┘ \n'
            ' ┌────────┐  └────────┘  └──┘  │  └──┘  │  │  └──┐  │  └──┐ \n'
            ' │  ┌──┐  │  ┌─────────────────┘  ┌──┐  │  │  ┌──┘  └──┐  │ \n'
            ' └──┘  │  │  │  ┌──┐  ┌──┐  ┌─────┘  └──┘  │  │  ┌──┐  └──┘ \n'
            ' ┌─────┘  └──┘  │  └──┘  │  └──┐  ┌────────┘  └──┘  └─────┐ \n'
            ' │  ┌───────────┘  ┌─────┘  ┌──┘  └───────────┐  ┌────────┘ \n'
            ' │  │  ┌────────┐  └─────┐  │  ┌────────┐  ┌──┘  └──┐  ┌──┐ \n'
            ' └──┘  │  ┌──┐  └──┐  ┌──┘  └──┘  ┌─────┘  │  ┌─────┘  │  │ \n'
            ' ┌─────┘  │  └──┐  │  │  ┌─────┐  │  ┌─────┘  └────────┘  │ \n'
            ' └─────┐  └──┐  │  └──┘  └──┐  │  └──┘  ┌──────────────┐  │ \n'
            ' ┌─────┘  ┌──┘  └──┐  ┌──┐  │  │  ┌──┐  └──┐  ┌──┐  ┌──┘  │ \n'
            ' │  ┌──┐  │  ┌──┐  └──┘  │  │  │  │  │  ┌──┘  │  │  └──┐  │ \n'
            ' │  │  │  └──┘  └─────┐  │  │  │  │  │  └─────┘  │  ┌──┘  │ \n'
            ' └──┘  └──────────────┘  └──┘  └──┘  └───────────┘  └─────┘ '
        )

        game_solver = MitiSolver(dots_positions, size)
        solution = game_solver.get_solution()
        self.assertEqual(expected_solution_str, str(solution))
        other_solution = game_solver.get_other_solution()
        self.assertEqual(Grid.empty(), other_solution)
